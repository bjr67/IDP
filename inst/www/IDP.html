<!DOCTYPE html>
<html>
<head>

<!-- Reads a sequence and maps the transformation from amino acid to propensity values (Hilser) -->
	
<style>
#header {
    background-color:black;
    margin: auto;
    color:white;
    text-align:center;
    width: 600px;
    padding:5px;
}
#nav {
    line-height:30px;
    background-color:#eeeeee;
    height:300px;
    width:100px;
    float:left;
    padding:5px;
}
#section {
	margin: auto;
    width:350px;
    float:left;
    padding:10px;
}
#footer {
	margin: auto;
    background-color:black;
    width: 600px;
    color:white;
    clear:both;
    text-align:center;
    padding:5px;
}    
#body {
	margin: auto;
	width: 600px;
	text-align:left;
	padding:5px;
	} 
#plotdiv {
		margin: auto;
		float:none;
		width: 600px;
		height: 600px;
		border: solid gray 1px;
		}
#plotdiv1 {
		margin: auto;
		float:none;
		width: 600px;
		height: 600px;
		border: solid gray 1px;
}
#plotdiv2 {
		margin: auto;
		float:none;
		width: 600px;
		height: 600px;
		border: solid gray 1px;
}
</style>

<title>IDP Structure</title>

     <script>
	function myFunction() {
	//      first show relationship of AA and propensity
        	var A = 0.37;
        	var C = 0.25;
        	var D = 0.30;
        	var E = 0.42;
        	var F = 0.17;
        	var G = 0.13;
        	var H = 0.20;
        	var I = 0.39;
        	var K = 0.56;
        	var L = 0.24;
        	var M = 0.36;
        	var N = 0.27;
        	var P = 1.00;
        	var Q = 0.53;
        	var R = 0.38;
        	var S = 0.24;
        	var T = 0.32;
         	var V = 0.39;
        	var W = 0.25;
        	var Y = 0.25;

 //import sequence

 	var string;
 	string = document.getElementById("seq").value;
 	string = string.trim();
 	string = string.toUpperCase();

// determine fppii, total positive charge, total negative charge

	var fppii_sum = 0;
	var tpc = 0;
	var tnc = 0;
 	var i;
 	var new_string = "";
 	var new_work_string = "";
 	for (i = 1; i < string.length + 1; i++)  {
	if (((string.substring((i-1),i) == "A" || 
	(string.substring((i-1),i)) == "C" )) || 
	(string.substring((i-1),i)) == "D" ||
	(string.substring((i-1),i)) == "E" ||
	(string.substring((i-1),i)) == "F" ||
	(string.substring((i-1),i)) == "G" ||
	(string.substring((i-1),i)) == "H" ||
	(string.substring((i-1),i)) == "I" ||
	(string.substring((i-1),i)) == "K" ||
	(string.substring((i-1),i)) == "L" ||
	(string.substring((i-1),i)) == "M" ||
	(string.substring((i-1),i)) == "N" ||
	(string.substring((i-1),i)) == "P" ||
	(string.substring((i-1),i)) == "Q" ||
	(string.substring((i-1),i)) == "R" ||
	(string.substring((i-1),i)) == "S" ||
	(string.substring((i-1),i)) == "T" ||
	(string.substring((i-1),i)) == "V" ||
	(string.substring((i-1),i)) == "W" ||
	(string.substring((i-1),i)) == "Y")
	{new_work_string = new_string.concat(string.substring((i-1),i));
	 new_string = new_work_string.trim();
	 fppii_sum = fppii_sum + eval(string.substring((i-1),i));}

	else if (string.substring((i-1),i) == " " ) {void(0);}
	else {
		alert("Please choose capital amino acid one-letter abbreviations");
		throw new Error();}
	}
for (i = 1; i < new_string.length + 1; i++)  {		
// net positive charge
		if ((new_string.substring((i-1),i) == "K")) {
			tpc = tpc + 1;}
		if((new_string.substring((i-1),i) == "R")) {
			tpc = tpc + 1;}
// net negative charge 
		if ((new_string.substring((i-1),i) == "D")) {
                	tnc = tnc + 1;}
        	if((new_string.substring((i-1),i) == "E")) {
                	tnc = tnc + 1;}
}
// net charge, average ppii, uncorrected and corrected rh, the contribution of charge and percent of charge
	var netcharge = Math.abs(tpc - tnc);
	var fppii_avg = fppii_sum / new_string.length;
	var rh = 2.16 * Math.pow(new_string.length, (0.503-(0.11*Math.log(1-fppii_avg)))) + (0.173*netcharge - 0.073 * 2.16 * Math.pow(new_string.length, (0.503-(0.11*Math.log(1-0.012)))));
	var chg_contribution = 0.17158*netcharge;
	var percentchg = Math.abs(chg_contribution)/rh;
	var rcoil = 2.16 * Math.pow(new_string.length,(0.503-(0.11*Math.log(1-0.012))));

	// output
document.getElementById("data").innerHTML = 
"Sequence : " + new_string + "<br>" + 
"Length (N) : " + new_string.length + "<br>" + 
"Chain averaged Fppii : " + fppii_avg + "<br>" +
"Total positive charge (K & R): " + tpc + "<br>" +
"Total negative charge (D & E): " + tnc + "<br>" +
"Net charge : " + netcharge + "<br>" +
"Hydrodynamic Radius, Rh : " + rh + "<br>" + 
"Random coil hydrodynamic radius, Rh : " + rcoil + "<br>" +
"Charge contribution Rh : " + chg_contribution + "<br>" + 
"Percent of Charge Contribution : " + percentchg*100 + "<br>" ;}

</script>
	
    <!-- Include order: first jquery, then opencpu.js, and then your code -->
    <script src="opencpu/jquery-1.10.2.min.js"></script>
    <script src="opencpu/opencpu-0.4.js"></script>
    
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="jqueryui/css/ui-lightness/jquery-ui-1.10.3.custom.css" rel="stylesheet" media="screen">

<script src="bootstrap/js/bootstrap.js"> </script>
<script src="jqueryui/jquery-ui-1.10.3.custom.js"> </script>

<script>
    //init this script when the page has loaded
    $(document).ready(function(){
      $("#submitbutton").on("click", function(){
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
        
        //read the value for 'seq'
        var ss = $("#seq").val();
        
        //create plot area, plotdiv
        var req = $("#plotdiv").rplot("IDP", {
        ss : ss
        })
        
        req.fail(function(){
        	alert(req.responseText);
        })
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });
    });
    </script>
    
    <script>
    //init this script when the page has loaded
    $(document).ready(function(){
      $("#submitbutton").on("click", function(){
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
        
        //read the value for 'seq'
        var sss = $("#seq").val();
        
        //create plot area, plotdiv
        var req = $("#plotdiv1").rplot("IDP2", {
        sss : sss
        })
        
        req.fail(function(){
        	alert(req.responseText);
        })
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });
    });
    </script>
    
    
    <script>
    //init this script when the page has loaded
    $(document).ready(function(){
      $("#submitbutton").on("click", function(){
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
        
        //read the value for 'seq'
        var ssss = $("#seq").val();
        
        //create plot area, plotdiv
        var req = $("#plotdiv2").rplot("IDP3", {
        ssss : ssss
        })
        
        req.fail(function(){
        	alert(req.responseText);
        })
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });
    });
    </script>

  </head>
    
<body>
  <div align="center" id="header">
		<h1> Structural Contributions of IDPs </h1>
	</div>
    <br>
	<br>
	<div align="center" id="body"><p> Enter a sequence of the one-letter abbreviation of the residues of an intrinisically disordered protein (IDP) and this tool will calculate the length, net positive charge, net negative charge, net charge, polyproline-II helix propensities, hydrodynamic radius, calculated charge effect, and isoelectric point. Propensities for polyproline-II helical confirmation were used from the Hisler Data set.  </p> 
  		Enter IDP sequence: <input id="seq" type="text" name="IDPAA" value=" ">
  		<br>
		<br>

    <button align= "center" id="submitbutton" type="button" onclick="myFunction()">Submit</button>
    
	<p id="dummy" align="center"></p>
    <p id="data" align="center"></p>
    <p id="output" align= "center"</p>
    <p id="error" align= "center"></p>
    <br><br><p>The first graph shows the measured Rh of 22 proteins and their respective number of residues. The red dot is the input sequence.
    <br>
    <br>The second graph shows the ffppii propensity distribution, based on the location of the residue and the fppii value at that residue. The color values represent polarity and charge, where nonpolar, polar, positively charged, negatively charged, and aromatic residues are represented by black, cyan, red, blue, and orange, respectively.
    <br>
    <br>The third graph shows the isoelectric point for each amino acid in the sequence.</p></div>
    <div id="plotdiv"></div>
    <div id="plotdiv1"></div>
    <div id="plotdiv2"></div>
    
  </body>
</html>