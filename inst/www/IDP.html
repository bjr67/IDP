<!DOCTYPE html>
<html>
<head>

<!-- Reads a sequence and maps the transformation from amino acid to propensity values (Hilser) -->
	
<style>
a:link {
    text-decoration: none;
    color: black;
}

a:visited {
    text-decoration: none;
    color: black;
}

a:hover {
    text-decoration: underline;
    color: black;
}

a:active {
    text-decoration: underline;
    color: black;
}

#header {
    background-color:black;
    color:white;
    text-align:center;
    width: 600px;
    padding:5px;
}
#nav {
    line-height:30px;
    background-color:#eeeeee;
    height:300px;
    width:100px;
    float:left;
    padding:5px;
}
#section {
    width:600px;
    float:left;
    padding:10px;
}
#footer {
	margin: auto;
    background-color:black;
    width: 600px;
    color:white;
    clear:both;
    text-align:center;
    padding:5px;
}    
#body {
	margin: auto;
	float:left;
	width: 600px;
	text-align:left;
	padding:5px;
	} 
#plotdiv {
		display:none;
		margin: auto;
		float:none;
		width: 500px;
		height: 500px;
		border: solid gray 1px;
		}
#plotdiv1 {
		display: none;
		margin: auto;
		float:none;
		width: 500px;
		height: 500px;
		border: solid gray 1px;
}
#plotdiv2 {
		display: none;
		margin: auto;
		float:none;
		width: 500px;
		height: 500px;
		border: solid gray 1px;
}
</style>

<title>IDP Structure</title>

     <script>
    function someFunctions(){
    myFunction();
	showdiv();
	}
		function myFunction() {
	//      first show relationship of AA and propensity
        	var A = 0.37;
        	var C = 0.25;
        	var D = 0.30;
        	var E = 0.42;
        	var F = 0.17;
        	var G = 0.13;
        	var H = 0.20;
        	var I = 0.39;
        	var K = 0.56;
        	var L = 0.24;
        	var M = 0.36;
        	var N = 0.27;
        	var P = 1.00;
        	var Q = 0.53;
        	var R = 0.38;
        	var S = 0.24;
        	var T = 0.32;
         	var V = 0.39;
        	var W = 0.25;
        	var Y = 0.25;

 //import sequence

 	var string;
 	string = document.getElementById("seq").value;
 	string = string.trim();
 	string = string.toUpperCase();

// determine fppii, total positive charge, total negative charge

	var fppii_sum = 0;
	var tpc = 0;
	var tnc = 0;
 	var i;
 	var new_string = "";
 	var new_work_string = "";
 	for (i = 1; i < string.length + 1; i++)  {
	if (((string.substring((i-1),i) == "A" || 
	(string.substring((i-1),i)) == "C" )) || 
	(string.substring((i-1),i)) == "D" ||
	(string.substring((i-1),i)) == "E" ||
	(string.substring((i-1),i)) == "F" ||
	(string.substring((i-1),i)) == "G" ||
	(string.substring((i-1),i)) == "H" ||
	(string.substring((i-1),i)) == "I" ||
	(string.substring((i-1),i)) == "K" ||
	(string.substring((i-1),i)) == "L" ||
	(string.substring((i-1),i)) == "M" ||
	(string.substring((i-1),i)) == "N" ||
	(string.substring((i-1),i)) == "P" ||
	(string.substring((i-1),i)) == "Q" ||
	(string.substring((i-1),i)) == "R" ||
	(string.substring((i-1),i)) == "S" ||
	(string.substring((i-1),i)) == "T" ||
	(string.substring((i-1),i)) == "V" ||
	(string.substring((i-1),i)) == "W" ||
	(string.substring((i-1),i)) == "Y")
	{new_work_string = new_string.concat(string.substring((i-1),i));
	 new_string = new_work_string.trim();
	 fppii_sum = fppii_sum + eval(string.substring((i-1),i));}

	else if (string.substring((i-1),i) == " " ) {void(0);}
	else {
		alert("Please choose capital amino acid one-letter abbreviations");
		throw new Error();}
	}
for (i = 1; i < new_string.length + 1; i++)  {		
// net positive charge
		if ((new_string.substring((i-1),i) == "K")) {
			tpc = tpc + 1;}
		if((new_string.substring((i-1),i) == "R")) {
			tpc = tpc + 1;}
// net negative charge 
		if ((new_string.substring((i-1),i) == "D")) {
                	tnc = tnc + 1;}
        	if((new_string.substring((i-1),i) == "E")) {
                	tnc = tnc + 1;}
}
// net charge, average ppii, uncorrected and corrected rh, the contribution of charge and percent of charge
	var netcharge = Math.abs(tpc - tnc);
	var fppii_avg = fppii_sum / new_string.length;
	var rh = 2.16 * Math.pow(new_string.length, (0.503-(0.11*Math.log(1-fppii_avg)))) + (0.173*netcharge - 0.073 * 2.16 * Math.pow(new_string.length, (0.503-(0.11*Math.log(1-0.012)))));
	var chg_contribution = 0.17158*netcharge;
	var percentchg = Math.abs(chg_contribution)/rh;
	var rcoil = 2.16 * Math.pow(new_string.length,(0.503-(0.11*Math.log(1-0.012))));

	// output
document.getElementById("data").innerHTML = 
"Sequence : " + new_string + "<br>" + 
"Length (N) : " + new_string.length + "<br>" + 
"Chain averaged Fppii : " + fppii_avg + "<br>" +
"Total positive charge (K & R): " + tpc + "<br>" +
"Total negative charge (D & E): " + tnc + "<br>" +
"Net charge : " + netcharge + "<br>" +
"Hydrodynamic Radius, Rh : " + rh + "<br>" + 
"Random coil hydrodynamic radius, Rh : " + rcoil + "<br>" +
"Charge contribution Rh : " + chg_contribution + "<br>" + 
"Percent of Charge Contribution : " + percentchg*100 + "<br>" ;

// format data for bar graph (using Plotly.js)
		
		var seqArray = new Array(string.length);
		var propArray = new Array(string.length);
		var chargeArray = new Array(string.length);
		var position = new Array(string.length);
		var propAvg = new Array(string.length);
		var chrgNum = new Array(string.length);
		var chrgAvg = new Array(string.length);
		
		
		for(i = 1; i < string.length+1; i++) //populate arrays
		{
			switch(string.substring((i-1), i))
			{
				case "A":
					position[i-1] = i;
					seqArray[i-1] = "A";
					propArray[i-1] = A;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "C":
					position[i-1] = i;
					seqArray[i-1] = "C";
					propArray[i-1] = C;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "D":
					position[i-1] = i;
					seqArray[i-1] = "D";
					propArray[i-1] = D;
					chargeArray[i-1] = 'rgba(222,45,38,0.8)';
					chrgNum[i-1] = -1;
					break;
				
				case "E":
					position[i-1] = i;
					seqArray[i-1] = "E";
					propArray[i-1] = E;
					chargeArray[i-1] = 'rgba(222,45,38,0.8)';
					chrgNum[i-1] = -1;
					break;
				
				case "F":
					position[i-1] = i;
					seqArray[i-1] = "F";
					propArray[i-1] = F;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "G":
					position[i-1] = i;
					seqArray[i-1] = "G";
					propArray[i-1] = G;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "H":
					position[i-1] = i;
					seqArray[i-1] = "H";
					propArray[i-1] = H;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "I":
					position[i-1] = i;
					seqArray[i-1] = "I";
					propArray[i-1] = I;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "K":
					position[i-1] = i;
					seqArray[i-1] = "K";
					propArray[i-1] = K;
					chargeArray[i-1] = 'rgb(49,130,189)';
					chrgNum[i-1] = 1;
					break;
				
				case "L":
					position[i-1] = i;
					seqArray[i-1] = "L";
					propArray[i-1] = L;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "M":
					position[i-1] = i;
					seqArray[i-1] = "M";
					propArray[i-1] = M;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "N":
					position[i-1] = i;
					seqArray[i-1] = "N";
					propArray[i-1] = N;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "P":
					position[i-1] = i;
					seqArray[i-1] = "P";
					propArray[i-1] = P;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "Q":
					position[i-1] = i;
					seqArray[i-1] = "Q";
					propArray[i-1] = Q;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "R":
					position[i-1] = i;
					seqArray[i-1] = "R";
					propArray[i-1] = R;
					chargeArray[i-1] = 'rgb(49,130,189)';
					chrgNum[i-1] = 1;
					break;
				
				case "S":
					position[i-1] = i;
					seqArray[i-1] = "S";
					propArray[i-1] = S;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "T":
					position[i-1] = i;
					seqArray[i-1] = "T";
					propArray[i-1] = T;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "V":
					position[i-1] = i;
					seqArray[i-1] = "V";
					propArray[i-1] = V;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "W":
					position[i-1] = i;
					seqArray[i-1] = "W";
					propArray[i-1] = W;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
				
				case "Y":
					position[i-1] = i;
					seqArray[i-1] = "Y";
					propArray[i-1] = Y;
					chargeArray[i-1] = 'rgba(204,204,204,1)';
					chrgNum[i-1] = 0;
					break;
			}
		}
		
		for(k = 1; k < string.length-1; k++)
		{
			propAvg[k-1] = (propArray[k-1]+propArray[k]+propArray[k+1])/3;
			var locAvg = chrgNum[k-1]+chrgNum[k]+chrgNum[k+1];
			if(locAvg > 0) // positive
			{
				chrgAvg[k-1] = 'rgb(49,130,189)';
			}
			else if(locAvg < 0) // negative
			{
				chrgAvg[k-1] = 'rgba(222,45,38,0.8)';
			}
			else // neutral
			{
				chrgAvg[k-1] = 'rgba(204,204,204,1)';
			}
		}
		
		var graph1Data = [
			{
				x: position,
				y: propArray,
				marker:{
					color: chargeArray
				},
				type: 'bar',
				text: seqArray,
				hoverinfo: 'text'
			}
		];
		
		var graph1Layout = {
			title: 'PPII Propensity vs Sequence Position'	
		}
		
		Plotly.newPlot('graph1', graph1Data, graph1Layout);
		
		var graph2Data = [
			{
				x: position,
				y: propAvg,
				marker: {
					color: chrgAvg
				},
				type: 'bar'
			}
		];
		
		var graph2Layout = {
			title: 'Averaged PPII Propensity vs Sequence Position'
		}
		
		Plotly.newPlot('graph2', graph2Data, graph2Layout);
}

</script>
	
    <!-- Include order: first jquery, then opencpu.js, and then your code -->
    <script src="opencpu/jquery-1.10.2.min.js"></script>
    <script src="opencpu/opencpu-0.4.js"></script>
    
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="jqueryui/css/ui-lightness/jquery-ui-1.10.3.custom.css" rel="stylesheet" media="screen">

<script src="bootstrap/js/bootstrap.js"> </script>
<script src="jqueryui/jquery-ui-1.10.3.custom.js"> </script>

<script>
    //init this script when the page has loaded
    $(document).ready(function(){
      $("#submitbutton").on("click", function(){
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
        
        //read the value for 'seq'
        var ss = $("#seq").val();
        
        //create plot area, plotdiv
        var req = $("#plotdiv").rplot("IDP", {
        ss : ss
        })
        
        req.fail(function(){
        	alert(req.responseText);
        })
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });
    });
    </script>
    
    <script>
    //init this script when the page has loaded
    $(document).ready(function(){
      $("#submitbutton").on("click", function(){
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
        
        //read the value for 'seq'
        var sss = $("#seq").val();
        
        //create plot area, plotdiv
        var req = $("#plotdiv1").rplot("IDP2", {
        sss : sss
        })
        
        req.fail(function(){
        	alert(req.responseText);
        })
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });
    });
    </script>
    
    
    <script>
    //init this script when the page has loaded
    $(document).ready(function(){
      $("#submitbutton").on("click", function(){
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
        
        //read the value for 'seq'
        var ssss = $("#seq").val();
        
        //create plot area, plotdiv
        var req = $("#plotdiv2").rplot("IDP3", {
        ssss : ssss
        })
        
        req.fail(function(){
        	alert(req.responseText);
        })
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });
    });
    </script>
    
    <script>
    //init this script when the page has loaded
    
function showdiv() {
   document.getElementById('plotdiv').style.display = "block";
   document.getElementById('plotdiv1').style.display = "block";
}
    </script>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="jquery-1.12.0.min.js"></script>
</head>

  <div align="center" id="header">
		<h1> Structural Contributions of IDPs </h1>
	</div>
    <br>
	<br>
<div align="left" id="nav">
<a href="IDP.html"><b>IDP tool</b></a><br>
<a href="about.html">About</a><br>
<a href="cite.html">Citation</a><br>
</div>
<body>
	<div id="section"><p> Enter a sequence of the one-letter abbreviation of the residues of an intrinsically disordered protein (IDP) and this tool will calculate the source of contributing elements to hydrodynamic radius, Rh.</p> 
  	<form id="frm1" action="form_action.asp name= "TESTING">  		Enter IDP sequence: <input id="seq" type="text" name="IDPAA" value=" ">
  	</form>
  		<br>
		<br>

    <button align= "center" id="submitbutton" type="button" onclick="someFunctions()" onclick="ShowDiv()" >Submit</button>
    
    <p id="data"></p>
    <div id="graph1" style="width:600px;height:250px;"></div>
    <div id="graph2" style="width:600px;height:250px;"></div>
    <p id="dummy" align="center"></p>
    <p id="data" align="center"></p>
    <p id="output" align= "center"</p>
    <p id="error" align= "center"></p>
    <div id="plotdiv"></div>
    <p><br>
    <br></p>
    <div id="plotdiv1"></div>
    
  </body>
</html>